"use strict";var _interopRequireDefault=require("@babel/runtime-corejs3/helpers/interopRequireDefault");var _Object$defineProperty=require("@babel/runtime-corejs3/core-js-stable/object/define-property");_Object$defineProperty(exports,"__esModule",{value:true});exports.api=api;var _assign=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/assign"));var _permissions=_interopRequireDefault(require("./permissions"));const log=(...args)=>console.log('@mna/content-server/api',...args);async function api(props){const{type,action,data,content,user,req,res,state,actions}=props;const{auth,types}=state;if(!type)throw{message:`Field "type" is required`};if(!action)throw{message:`Field "action" is required`};if(!types[type])throw{message:`Type "${type}" doesn't exist`};if(!types[type][action])throw{message:`Type "${type}" doesn't have action "${action}"`};const{permissions=[]}=types[type];const actionProps={type,action,data,types,content,auth,user,permissions,req,res};(0,_assign.default)(actionProps,(0,_permissions.default)(actionProps));try{return await types[type][action](actionProps);}catch(e){console.error('@mna/content-server/api',{type,action,data},e);throw e;}}