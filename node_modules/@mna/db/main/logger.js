"use strict";var _interopRequireDefault=require("@babel/runtime-corejs3/helpers/interopRequireDefault");var _forEach=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/for-each"));var _setImmediate2=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/set-immediate"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/objectWithoutProperties"));let Persistence=require("./persistence"),model=require("./model"),customUtils=require("./customUtils"),mkdirp=require('mkdirp'),fs=require('fs'),path=require('path'),util=require('util');function Logger(_ref){let{onload}=_ref,dbOptions=(0,_objectWithoutProperties2.default)(_ref,["onload"]);dbOptions.inMemoryOnly=false;dbOptions.autoload=false;mkdirp.sync(path.dirname(dbOptions.filename));if(!fs.existsSync(dbOptions.filename)){fs.writeFileSync(dbOptions.filename,'','utf8');}this.persistence=new Persistence({db:dbOptions});if(onload)(0,_setImmediate2.default)(onload);}Logger.prototype.insert=function(_docs,cb){let callback=cb||function(){},docs=util.isArray(_docs)?_docs:[_docs],preparedDocs=[];try{(0,_forEach.default)(docs).call(docs,function(doc){preparedDocs.push(model.deepCopy(doc));});(0,_forEach.default)(preparedDocs).call(preparedDocs,function(doc){doc.id=customUtils.uid(16);doc.created=new Date();model.checkObject(doc);});this.persistence.persistNewState(preparedDocs,callback);}catch(err){return callback(err);}};module.exports=Logger;